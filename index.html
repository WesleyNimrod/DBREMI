<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Customer Eligibility Check</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#261FB3',
                        secondary: '#262a5a',
                        lightblue: '#caf0f8',
                        lightgreen: '#d8f3dc',
                        lightyellow: '#ffedd8',
                        lightred: '#ffccd5',
                        lightgray: '#f3f4f6'
                    },
                    fontFamily: {
                        tahoma: ['Tahoma', 'Geneva', 'sans-serif']
                    }
                }
            },
            darkMode: 'class'
        }
    </script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Tahoma:wght@400;700&display=swap');
        
        body {
            font-family: 'Tahoma', Geneva, sans-serif;
        }
        
        @keyframes redFlash {
            0% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(239, 68, 68, 0); }
            100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0); }
        }
        .dbr-warning-flash {
            animation: redFlash 1s ease-in-out 3;
            border: 2px solid rgba(239, 68, 68, 0.7) !important;
            background-color: rgba(239, 68, 68, 0.05) !important;
        }
        
        .dark .dbr-warning-flash {
            border: 2px solid rgba(248, 113, 113, 0.7) !important;
            background-color: rgba(248, 113, 113, 0.1) !important;
        }
        
        .dbr-high {
            color: #ef4444 !important;
            font-weight: bold;
            background-color: rgba(239, 68, 68, 0.1) !important;
            border-color: #ef4444 !important;
        }

        .dark .dbr-high {
            color: #f87171 !important;
            background-color: rgba(248, 113, 113, 0.1) !important;
            border-color: #f87171 !important;
        }
        
        .card-settled {
            opacity: 0.6;
            background-color: #f3f4f6 !important;
            border: 1px dashed #9ca3af !important;
        }
        
        .dark .card-settled {
            background-color: #374151 !important;
            border: 1px dashed #6b7280 !important;
        }
        
        .loan-settled {
            opacity: 0.6;
            background-color: #f3f4f6 !important;
            border: 1px dashed #9ca3af !important;
        }
        
        .dark .loan-settled {
            background-color: #374151 !important;
            border: 1px dashed #6b7280 !important;
        }
        
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 50;
        }
        
        .modal-content {
            background: white;
            padding: 20px;
            border-radius: 8px;
            max-width: 90%;
            max-height: 90%;
            overflow-y: auto;
            width: 900px;
        }
        
        .dark .modal-content {
            background: #1f2937;
            color: white;
        }
        
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }
        
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 24px;
        }
        
        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        
        input:checked + .toggle-slider {
            background-color: #2D336B !important;
        }
        
        input:checked + .toggle-slider:before {
            transform: translateX(26px);
        }
        
        .btn-icon {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            padding: 0.5rem;
            border-radius: 0.375rem;
            transition: all 0.2s;
            width: 60px;
            height: 60px;
        }
        
        .btn-icon i {
            font-size: 1.5rem;
            margin-bottom: 0.25rem;
        }
    </style>
</head>
<body class="bg-gray-50 transition-colors duration-200 font-tahoma">
    <!-- Theme toggle -->
    <div class="flex justify-end items-center p-4">
        <span class="mr-2 text-gray-700 dark:text-gray-300"><i class="fas fa-sun"></i></span>
        <label class="toggle-switch">
            <input type="checkbox" id="themeToggle">
            <span class="toggle-slider"></span>
        </label>
        <span class="ml-2 text-gray-700 dark:text-gray-300"><i class="fas fa-moon"></i></span>
    </div>
    
    <div class="container mx-auto px-4 py-4 max-w-6xl" id="printableArea">
        <h1 class="text-3xl font-bold text-center text-primary dark:text-white mb-8">Customer Eligibility Check</h1>
                
        <!-- Menu Section (Formerly Share Details) -->
        <div class="mb-6 bg-white dark:bg-gray-800 p-4 rounded-lg shadow-md border-l-4 border-primary">
            <h2 class="text-2xl font-bold text-primary dark:text-white mb-4">MENU</h2>
            
            <!-- WhatsApp Input and Button Group -->
            <div class="flex items-center justify-center mb-4">
                <div class="flex items-center w-full md:w-1/2">
                    <input type="tel" id="whatsappNumber" placeholder="Enter WhatsApp number" class="border rounded-l-md p-2 text-base dark:bg-gray-800 dark:text-white flex-grow">
                    <button id="sendWhatsAppBtn" class="bg-green-600 text-white px-3 py-2 rounded-r-md hover:bg-opacity-80">
                        <i class="fab fa-whatsapp"></i>
                    </button>
                </div>
            </div>
            
            <!-- Icon Buttons Grid -->
            <div class="grid grid-cols-4 sm:grid-cols-6 md:grid-cols-8 gap-2 justify-center">
                <div class="col-span-4 sm:col-span-6 md:col-span-8 flex flex-wrap justify-center gap-2">
                    <a href="https://script.google.com/macros/s/AKfycbyt6zvvO5POe2jMnyaR2bJOPu09L2f2Rr3Aeh72_APIR1C-6JVzSDOZvGfi4ZOZbQL0/exec" class="btn-icon bg-red-500 text-white hover:bg-opacity-80">
                        <i class="fas fa-chart-line"></i>
                        <span>Tracker</span>
                    </a>
                    <button id="showEmiChartBtn" class="btn-icon bg-yellow-400 text-white hover:bg-opacity-80">
                        <i class="fas fa-chart-bar"></i>
                        <span>EMI Chart</span>
                    </button>
                    <button id="printBtn" class="btn-icon bg-blue-500 text-white hover:bg-opacity-80">
                        <i class="fas fa-print"></i>
                        <span>Print</span>
                    </button>
                    <button id="exportPdfBtn" class="btn-icon bg-blue-800 text-white hover:bg-opacity-80">
                        <i class="fas fa-file-pdf"></i>
                        <span>PDF</span>
                    </button>
                    <button id="loanComparisonBtn" class="btn-icon bg-purple-800 text-white hover:bg-opacity-80">
                        <i class="fas fa-balance-scale"></i>
                        <span>Compare</span>
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Main Calculator Container -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            
            <!-- Left Column - DBR Calculator -->
            <div id="dbrCalculator" class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-md border-l-4 border-primary">
                <h2 class="text-2xl font-bold text-primary dark:text-white mb-6">DBR CALCULATOR</h2>
                
                <div class="space-y-3">
                    <div class="grid grid-cols-3 gap-3 items-center">
                        <label class="text-gray-700 dark:text-gray-300 font-medium">Salary (AED):</label>
                        <input type="number" id="salary" class="col-span-2 border rounded-md p-2 text-base dark:bg-gray-800 dark:text-white">
                    </div>
                    
                    <!-- Add-back section -->
                    <div id="addbacks-container">
                        <div class="grid grid-cols-3 gap-3 items-center addback-entry">
                            <label class="text-gray-700 dark:text-gray-300 font-medium">Add-back:</label>
                            <div class="col-span-2">
                                <select class="addback-type border rounded-md p-2 text-base dark:bg-gray-800 dark:text-white w-full">
                                    <option value="">Select Add-back Type</option>
                                    <option value="hra">HRA</option>
                                    <option value="airfare">Airfare Allowance</option>
                                    <option value="overtime">Over-time</option>
                                    <option value="servicecharge">Service Charge</option>
                                    <option value="incentives">Incentives</option>
                                    <option value="telephone">Telephone Allowance</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div class="dynamic-addback-fields"></div>
                    
                    <div class="flex justify-start gap-2 mb-3">
                        <button id="addMoreAddbackBtn" class="bg-primary text-white p-2 rounded-md hover:bg-opacity-80">+ Add More</button>
                        <button id="removeAddbackBtn" class="bg-primary text-white p-2 rounded-md hover:bg-opacity-80 disabled:opacity-50" disabled>- Remove</button>
                    </div>
                    
                    <div class="grid grid-cols-3 gap-3 items-center">
                        <label class="text-gray-700 dark:text-gray-300 font-medium">Gross Salary:</label>
                        <input type="text" id="grossSalary" class="col-span-2 border rounded-md p-2 bg-lightgray dark:bg-gray-700 dark:text-white" readonly>
                    </div>
                    
                    <div class="grid grid-cols-3 gap-3 items-center">
                        <label class="text-gray-700 dark:text-gray-300 font-medium">Allowed Liability:</label>
                        <input type="text" id="allowedLiability" class="col-span-2 border rounded-md p-2 bg-lightgray dark:bg-gray-700 dark:text-white" readonly>
                    </div>
                    
                    <div class="grid grid-cols-3 gap-3 items-center">
                        <label class="text-gray-700 dark:text-gray-300 font-medium">DBR %:</label>
                        <div class="col-span-2 flex items-center">
                            <input type="text" id="dbrPercentage" class="border rounded-md p-2 bg-lightgray dark:bg-gray-700 dark:text-white" readonly>
                        </div>
                    </div>
                    
                    <button id="addExistingLoanBtn" class="bg-primary text-white p-2 rounded-md hover:bg-opacity-80 w-full">+ Existing Loans</button>
                    
                    <!-- Existing Loans Container -->
                    <div id="existingLoansContainer" class="mt-2 space-y-2 hidden">
                    </div>

                    <!-- Credit Cards Section -->
                    <div id="creditCardsContainer">
                        <div class="credit-card-entry mb-3">
                            <div class="flex justify-between items-center mb-2">
                                <label class="text-gray-700 dark:text-gray-300 font-medium">Credit Card 1:</label>
                                <button class="settle-card-btn bg-primary text-white px-4 py-1 rounded hover:bg-opacity-80">Settle</button>
                            </div>
                            <div class="grid grid-cols-4 gap-2">
                                <select class="card-bank-select border rounded-md p-2 text-base dark:bg-gray-800 dark:text-white col-span-1">
                                    <option value="ADCB">ADCB</option>
                                    <option value="ENBD">ENBD</option>
                                    <option value="EIB">EIB</option>
                                    <option value="FAB">FAB</option>
                                    <option value="ADIB">ADIB</option>
                                    <option value="CBD">CBD</option>
                                    <option value="CITI">CITI</option>
                                    <option value="SCB">SCB</option>
                                    <option value="MASHREQ">MASHREQ</option>
                                    <option value="DIB">DIB</option>
                                    <option value="OTHER">OTHER</option>
                                </select>
                                <input type="number" placeholder="Credit Limit" class="credit-card-amount border rounded-md p-2 text-base dark:bg-gray-800 dark:text-white col-span-1">
                                <input type="number" placeholder="Outstanding" class="credit-card-outstanding border rounded-md p-2 text-base dark:bg-gray-800 dark:text-white col-span-2">
                            </div>
                        </div>
                    </div>
                    
                    <div class="flex gap-2">
                        <button id="addCreditCardBtn" class="bg-primary text-white p-2 rounded-md hover:bg-opacity-80">+ Add Card</button>
                        <button id="removeCreditCardBtn" class="bg-primary text-white p-2 rounded-md hover:bg-opacity-80 disabled:opacity-50" disabled>- Remove Card</button>
                    </div>
                    
                    <div class="grid grid-cols-3 gap-3 items-center">
                        <label class="text-gray-700 dark:text-gray-300 font-medium">Total CC Limit:</label>
                        <input type="text" id="totalCCLimit" class="col-span-2 border rounded-md p-2 bg-lightgray dark:bg-gray-700 dark:text-white" readonly>
                    </div>
                    
                    <div class="grid grid-cols-3 gap-3 items-center">
                        <label class="text-gray-700 dark:text-gray-300 font-medium">DBR Of Credit Card:</label>
                        <div class="col-span-2 flex items-center">
                            <input type="text" id="dbrCC" class="border rounded-md p-2 bg-lightgray dark:bg-gray-700 dark:text-white flex-grow" readonly>
                            <div class="ml-2 flex items-center">
                                <span class="text-gray-700 dark:text-gray-300 text-sm mr-1">3%</span>
                                <label class="toggle-switch mx-1" style="width: 40px; height: 20px;">
                                    <input type="checkbox" id="dbrRateToggle">
                                    <span class="toggle-slider" style="border-radius: 20px;"></span>
                                </label>
                                <span class="text-gray-700 dark:text-gray-300 text-sm ml-1">5%</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-3 gap-3 items-center">
                        <label class="text-gray-700 dark:text-gray-300 font-medium">Total Liabilities:</label>
                        <input type="text" id="totalLiabilities" class="col-span-2 border rounded-md p-2 bg-lightgray dark:bg-gray-700 dark:text-white" readonly>
                    </div>
                    
                    <div class="grid grid-cols-3 gap-3 items-center">
                        <label class="text-gray-700 dark:text-gray-300 font-medium">Available Liability:</label>
                        <input type="text" id="availableLiability" class="col-span-2 border rounded-md p-2 bg-lightgray dark:bg-gray-700 dark:text-white" readonly>
                    </div>
                    
                    <div class="grid grid-cols-3 gap-3 items-center">
                        <label class="text-gray-700 dark:text-gray-300 font-medium">New Total Liabilities:</label>
                        <input type="text" id="newTotalLiabilities" class="col-span-2 border rounded-md p-2 bg-lightgray dark:bg-gray-700 dark:text-white" readonly>
                    </div>
                    
                    <div class="grid grid-cols-3 gap-3 items-center">
                        <label class="text-gray-700 dark:text-gray-300 font-medium">Special Note:</label>
                        <textarea id="specialNote" class="col-span-2 w-full border rounded-md p-2 text-base dark:bg-gray-800 dark:text-white" rows="3"></textarea>
                    </div>
                    
                    <div id="ccSuggestionContainer" class="border border-primary p-3 rounded-lg mt-3 hidden">
                        <h3 class="text-lg font-bold text-primary mb-2">CREDIT CARD SUGGESTION</h3>
                        <p id="ccSuggestionText" class="text-gray-700 dark:text-gray-300"></p>
                    </div>
                </div>
            </div>
            
            <!-- Right Column - EMI Calculator -->
            <div id="emiCalculator" class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-md border-l-4 border-primary">
                <h2 class="text-2xl font-bold text-primary dark:text-white mb-6">EMI CALCULATOR</h2>
                
                <div class="space-y-3">
                    <!-- Customer Profile Management -->
                    <div class="grid grid-cols-3 gap-3 items-center">
                        <label class="text-gray-700 dark:text-gray-300 font-medium">Customer Name:</label>
                        <input type="text" id="customerName" placeholder="Enter customer name" class="col-span-2 border rounded-md p-2 text-base dark:bg-gray-800 dark:text-white">
                    </div>
                    
                    <div class="grid grid-cols-3 gap-3 items-center">
                        <label class="text-gray-700 dark:text-gray-300 font-medium">Saved Profiles:</label>
                        <select id="savedProfiles" class="border rounded-md p-2 text-base dark:bg-gray-800 dark:text-white">
                            <option value="">Select a profile</option>
                        </select>
                        <div class="flex gap-1">
                            <button id="retrieveProfileBtn" class="bg-primary text-white p-2 rounded-md hover:bg-opacity-80 flex items-center justify-center">
                                <i class="fas fa-download mr-1"></i>
                            </button>
                            <button id="deleteProfileBtn" class="bg-red-500 text-white p-2 rounded-md hover:bg-opacity-80 flex items-center justify-center">
                                <i class="fas fa-trash-alt mr-1"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-3 gap-3 items-center">
                        <label class="text-gray-700 dark:text-gray-300 font-medium">Loan Type:</label>
                        <select id="loanType" class="col-span-2 border rounded-md p-2 text-base dark:bg-gray-800 dark:text-white">
                            <option value="fresh-0-30">Fresh (0-30 days)</option>
                            <option value="fresh-30-60">Fresh (30-60 days)</option>
                            <option value="topup-0-30">Top-up (0-30 days)</option>
                            <option value="topup-30-60">Top-up (30-60 days)</option>
                            <option value="takeover-60-90">Take over (60-90 days)</option>
                        </select>
                    </div>
                    
                    <div class="grid grid-cols-3 gap-3 items-center">
                        <label class="text-gray-700 dark:text-gray-300 font-medium">Disbursal Date:</label>
                        <input type="date" id="disbursalDate" class="col-span-2 border rounded-md p-2 text-base dark:bg-gray-800 dark:text-white">
                    </div>
                    
                    <div class="grid grid-cols-3 gap-3 items-center">
                        <label class="text-gray-700 dark:text-gray-300 font-medium">First Payment Date:</label>
                        <input type="date" id="firstPaymentDate" class="col-span-2 border rounded-md p-2 text-base dark:bg-gray-800 dark:text-white">
                        <p id="dateError" class="col-span-3 text-red-600 dark:text-red-400 text-sm hidden">Error: Invalid Payment Date</p>
                    </div>
                    
                    <div class="grid grid-cols-3 gap-3 items-center">
                        <label class="text-gray-700 dark:text-gray-300 font-medium">Days Between:</label>
                        <input type="text" id="daysBetween" class="col-span-2 border rounded-md p-2 bg-lightgray dark:bg-gray-700 dark:text-white" readonly>
                    </div>
                    
                    <div class="grid grid-cols-3 gap-3 items-center">
                        <label class="text-gray-700 dark:text-gray-300 font-medium">Multiples Of Salary:</label>
                        <input type="number" id="multiplesOfSalary" class="col-span-2 border rounded-md p-2 text-base dark:bg-gray-800 dark:text-white" value="15">
                    </div>
                    
                    <div class="grid grid-cols-3 gap-3 items-center">
                        <label class="text-gray-700 dark:text-gray-300 font-medium">Max Loan Eligibility (AED):</label>
                        <input type="text" id="maxLoanEligibility" class="col-span-2 border rounded-md p-2 bg-lightgray dark:bg-gray-700 dark:text-white" readonly>
                    </div>
                    
                    <div class="grid grid-cols-3 gap-3 items-center">
                        <label class="text-gray-700 dark:text-gray-300 font-medium">Tenure:</label>
                        <input type="number" id="tenureMonths" class="col-span-2 border rounded-md p-2 text-base dark:bg-gray-800 dark:text-white" value="48" min="1" max="300">
                    </div>
                    
                    <div class="grid grid-cols-3 gap-3 items-center">
                        <label class="text-gray-700 dark:text-gray-300 font-medium">Loan Amount (AED):</label>
                        <div class="col-span-2">
                            <input type="number" id="loanAmount" class="w-full border rounded-md p-2 text-base dark:bg-gray-800 dark:text-white">
                            <p id="loanAmountError" class="text-red-600 dark:text-red-400 text-sm hidden">Error: Loan Amount Will Exceed DBR Limit!</p>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-3 gap-3 items-center">
                        <label class="text-gray-700 dark:text-gray-300 font-medium">Reducing Rate %:</label>
                        <input type="number" id="reducingRate" step="0.01" class="col-span-2 border rounded-md p-2 text-base dark:bg-gray-800 dark:text-white" value="10">
                    </div>
                    
                    <div class="grid grid-cols-3 gap-3 items-center">
                        <label class="text-gray-700 dark:text-gray-300 font-medium">Flat Rate %:</label>
                        <input type="text" id="flatRate" step="0.01" class="col-span-2 border rounded-md p-2 bg-lightgray dark:bg-gray-700 dark:text-white" readonly>
                    </div>
                    
                    <div class="grid grid-cols-3 gap-3 items-center">
                        <label class="text-gray-700 dark:text-gray-300 font-medium">EMI (AED):</label>
                        <input type="text" id="emi" step="0.01" class="col-span-2 border rounded-md p-2 bg-lightgray dark:bg-gray-700 dark:text-white" readonly>
                    </div>
                    
                    <div class="grid grid-cols-3 gap-3 items-center">
                        <label class="text-gray-700 dark:text-gray-300 font-medium">Total Payment (AED):</label>
                        <input type="text" id="totalPayment" step="0.01" class="col-span-2 border rounded-md p-2 bg-lightgray dark:bg-gray-700 dark:text-white" readonly>
                    </div>
                    
                    <div class="grid grid-cols-3 gap-3 items-center">
                        <label class="text-gray-700 dark:text-gray-300 font-medium">Total Interest (AED):</label>
                        <input type="text" id="totalInterest" step="0.01" class="col-span-2 border rounded-md p-2 bg-lightgray dark:bg-gray-700 dark:text-white" readonly>
                    </div>
                    
                    <div class="grid grid-cols-3 gap-3 items-center">
                        <label class="text-gray-700 dark:text-gray-300 font-medium">Processing Fees + VAT (AED):</label>
                        <input type="text" id="processingFees" step="0.01" class="col-span-2 border rounded-md p-2 bg-lightgray dark:bg-gray-700 dark:text-white" readonly>
                    </div>
                    
                    <div class="grid grid-cols-3 gap-3 items-center">
                        <label class="text-gray-700 dark:text-gray-300 font-medium">Total Outstanding:</label>
                        <input type="text" id="totalOutstanding" class="col-span-2 border rounded-md p-2 bg-lightgray dark:bg-gray-700 dark:text-white" readonly>
                    </div>
                    
                    <div class="grid grid-cols-3 gap-3 items-center">
                        <label class="text-gray-700 dark:text-gray-300 font-medium">Cash In Hand - NetPay (AED):</label>
                        <input type="text" id="cashInHand" step="0.01" class="col-span-2 border rounded-md p-2 bg-lightgray dark:bg-gray-700 dark:text-white" readonly>
                    </div>
                    
                    <div class="grid grid-cols-3 gap-3 mt-4">
                        <button id="findOptimalLoanBtn" class="bg-primary text-white p-3 rounded-md hover:bg-opacity-80 text-base">
                            <i class="fas fa-search-dollar mr-1"></i> Optimal
                        </button>
                        <button id="resetBtn" class="bg-primary text-white p-3 rounded-md hover:bg-opacity-80 text-base">
                            <i class="fas fa-redo-alt mr-1"></i> Reset
                        </button>
                        <button id="saveProfileBtn" class="bg-primary text-white p-3 rounded-md hover:bg-opacity-80 text-base">
                            <i class="fas fa-save mr-1"></i> Save
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- EMI Chart Section -->
        <div id="emiChartSection" class="mt-8 bg-white dark:bg-gray-800 p-6 rounded-lg shadow-md border-l-4 border-primary hidden">
            <h2 class="text-2xl font-bold text-primary dark:text-white mb-6">EMI PAYMENT SCHEDULE</h2>
            <div class="relative" style="height: 350px;">
                <canvas id="emiChart"></canvas>
            </div>
            <div class="mt-6 overflow-x-auto">
                <table class="w-full border-collapse text-sm">
                    <thead>
                        <tr class="bg-primary text-white">
                            <th class="border border-gray-300 p-2">Month</th>
                            <th class="border border-gray-300 p-2">EMI (AED)</th>
                            <th class="border border-gray-300 p-2">Principal (AED)</th>
                            <th class="border border-gray-300 p-2">Interest (AED)</th>
                            <th class="border border-gray-300 p-2">Balance (AED)</th>
                        </tr>
                    </thead>
                    <tbody id="emiScheduleBody">
                        <!-- Will be populated by JavaScript -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    
    <!-- Loan Comparison Modal -->
    <div id="loanComparisonModal" class="modal hidden">
        <div class="modal-content">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-2xl font-bold text-primary dark:text-white">LOAN COMPARISON</h2>
                <button id="closeComparisonModal" class="text-gray-700 dark:text-gray-300 hover:text-red-500 dark:hover:text-red-400 text-2xl">&times;</button>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                <!-- First Bank -->
                <div class="space-y-3">
                    <div class="grid grid-cols-3 gap-3 items-center">
                        <label class="text-gray-700 dark:text-gray-300 font-medium">Bank Name:</label>
                        <input type="text" id="bank1Name" class="col-span-2 border rounded-md p-2 text-base dark:bg-gray-800 dark:text-white">
                    </div>
                    
                    <div class="grid grid-cols-3 gap-3 items-center">
                        <label class="text-gray-700 dark:text-gray-300 font-medium">Loan Amount (AED):</label>
                        <input type="number" id="bank1LoanAmount" class="col-span-2 border rounded-md p-2 text-base dark:bg-gray-800 dark:text-white">
                    </div>
                    
                    <div class="grid grid-cols-3 gap-3 items-center">
                        <label class="text-gray-700 dark:text-gray-300 font-medium">Tenure (Months):</label>
                        <input type="number" id="bank1Tenure" class="col-span-2 border rounded-md p-2 text-base dark:bg-gray-800 dark:text-white">
                    </div>
                    
                    <div class="grid grid-cols-3 gap-3 items-center">
                        <label class="text-gray-700 dark:text-gray-300 font-medium">Reducing Rate (%):</label>
                        <input type="number" id="bank1Rate" step="0.01" class="col-span-2 border rounded-md p-2 text-base dark:bg-gray-800 dark:text-white">
                    </div>
                    
                    <div class="grid grid-cols-3 gap-3 items-center">
                        <label class="text-gray-700 dark:text-gray-300 font-medium">EMI (AED):</label>
                        <input type="text" id="bank1EMI" step="0.01" class="col-span-2 border rounded-md p-2 bg-lightgray dark:bg-gray-700 dark:text-white" readonly>
                    </div>
                    
                    <div class="grid grid-cols-3 gap-3 items-center">
                        <label class="text-gray-700 dark:text-gray-300 font-medium">Total Interest (AED):</label>
                        <input type="text" id="bank1TotalInterest" step="0.01" class="col-span-2 border rounded-md p-2 bg-lightgray dark:bg-gray-700 dark:text-white" readonly>
                    </div>
                </div>
                
                <!-- Second Bank -->
                <div class="space-y-3">
                    <div class="grid grid-cols-3 gap-3 items-center">
                        <label class="text-gray-700 dark:text-gray-300 font-medium">Bank Name:</label>
                        <input type="text" id="bank2Name" class="col-span-2 border rounded-md p-2 text-base dark:bg-gray-800 dark:text-white">
                    </div>
                    
                    <div class="grid grid-cols-3 gap-3 items-center">
                        <label class="text-gray-700 dark:text-gray-300 font-medium">Loan Amount (AED):</label>
                        <input type="number" id="bank2LoanAmount" class="col-span-2 border rounded-md p-2 text-base dark:bg-gray-800 dark:text-white">
                    </div>
                    
                    <div class="grid grid-cols-3 gap-3 items-center">
                        <label class="text-gray-700 dark:text-gray-300 font-medium">Tenure (Months):</label>
                        <input type="number" id="bank2Tenure" class="col-span-2 border rounded-md p-2 text-base dark:bg-gray-800 dark:text-white">
                    </div>
                    
                    <div class="grid grid-cols-3 gap-3 items-center">
                        <label class="text-gray-700 dark:text-gray-300 font-medium">Reducing Rate (%):</label>
                        <input type="number" id="bank2Rate" step="0.01" class="col-span-2 border rounded-md p-2 text-base dark:bg-gray-800 dark:text-white">
                    </div>
                    
                    <div class="grid grid-cols-3 gap-3 items-center">
                        <label class="text-gray-700 dark:text-gray-300 font-medium">EMI (AED):</label>
                        <input type="text" id="bank2EMI" step="0.01" class="col-span-2 border rounded-md p-2 bg-lightgray dark:bg-gray-700 dark:text-white" readonly>
                    </div>
                    
                    <div class="grid grid-cols-3 gap-3 items-center">
                        <label class="text-gray-700 dark:text-gray-300 font-medium">Total Interest (AED):</label>
                        <input type="text" id="bank2TotalInterest" step="0.01" class="col-span-2 border rounded-md p-2 bg-lightgray dark:bg-gray-700 dark:text-white" readonly>
                    </div>
                </div>
            </div>
            
            <div class="mt-6 p-4 bg-gray-100 dark:bg-gray-700 rounded-lg">
                <h3 class="text-xl font-semibold text-primary dark:text-white mb-2">COMPARISON RESULT</h3>
                <p id="comparisonResult" class="text-gray-700 dark:text-gray-300">Enter Details For Both Banks To Compare.</p>
            </div>
        </div>
    </div>
    
    <script>
        // Theme toggle functionality
        const themeToggle = document.getElementById('themeToggle');
        
        // Set light mode as default
        document.documentElement.classList.remove('dark');
        themeToggle.checked = false;
        
        themeToggle.addEventListener('change', function() {
            if (this.checked) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        });
        
        // Initialize the app when DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            // Helper function to format numbers with thousands separators
            function formatNumber(num) {
                return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
            }
            
            // References to DOM elements
            const salaryInput = document.getElementById('salary');
            const grossSalaryInput = document.getElementById('grossSalary');
            const allowedLiabilityInput = document.getElementById('allowedLiability');
            const dbrPercentageInput = document.getElementById('dbrPercentage');
            const addExistingLoanBtn = document.getElementById('addExistingLoanBtn');
            const existingLoansContainer = document.getElementById('existingLoansContainer');
            const addCreditCardBtn = document.getElementById('addCreditCardBtn');
            const removeCreditCardBtn = document.getElementById('removeCreditCardBtn');
            const creditCardsContainer = document.getElementById('creditCardsContainer');
            const totalCCLimitInput = document.getElementById('totalCCLimit');
            const dbrCCInput = document.getElementById('dbrCC');
            const dbrRateToggle = document.getElementById('dbrRateToggle');
            const totalOutstandingInput = document.getElementById('totalOutstanding');
            const customerNameInput = document.getElementById('customerName');
            const savedProfilesSelect = document.getElementById('savedProfiles');
            const retrieveProfileBtn = document.getElementById('retrieveProfileBtn');
            const deleteProfileBtn = document.getElementById('deleteProfileBtn');
            const saveProfileBtn = document.getElementById('saveProfileBtn');
            const loanTypeSelect = document.getElementById('loanType');
            const multiplesOfSalaryInput = document.getElementById('multiplesOfSalary');
            const maxLoanEligibilityInput = document.getElementById('maxLoanEligibility');
            const tenureMonthsInput = document.getElementById('tenureMonths');
            const loanAmountInput = document.getElementById('loanAmount');
            const loanAmountError = document.getElementById('loanAmountError');
            const reducingRateInput = document.getElementById('reducingRate');
            const flatRateInput = document.getElementById('flatRate');
            const emiInput = document.getElementById('emi');
            const totalPaymentInput = document.getElementById('totalPayment');
            const totalInterestInput = document.getElementById('totalInterest');
            const processingFeesInput = document.getElementById('processingFees');
            const cashInHandInput = document.getElementById('cashInHand');
            const totalLiabilitiesInput = document.getElementById('totalLiabilities');
            const availableLiabilityInput = document.getElementById('availableLiability');
            const newTotalLiabilitiesInput = document.getElementById('newTotalLiabilities');
            const findOptimalLoanBtn = document.getElementById('findOptimalLoanBtn');
            const resetBtn = document.getElementById('resetBtn');
            const disbu